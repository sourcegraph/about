{"expireTime":9007200905229171000,"key":"transformer-remark-markdown-html-ad3cb0bad03f52b8616cc9d85c591d64-gatsby-remark-autolink-headersgatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-unwrap-imagesgatsby-remark-imagesgatsby-remark-smartypants-","val":"<style>\n  .gatsby-highlight {\n    max-width: 100%;\n    width: 40rem;\n    margin-left: auto;\n    margin-right: auto;\n  }\n  @media screen and (min-width: 800px) {\n    table {\n      width: 40rem;\n      border: none;\n    }\n  }\n  table {\n    border: none;\n  }\n  table th {\n    border: none;\n  }\n  table td {\n    padding: 4px;\n    border: none;\n  }\n  table td:nth-child(2n) {\n    text-align: right;\n  }\n  table th:nth-child(2n) {\n    text-align: right;\n  }\n  table tr:nth-child(2n) {\n    background-color: transparent;\n  }\n</style>\n<p>I find code checkers like linters and lightweight static analyzers most\nvaluable when they teach me better ways to code in a language or framework. For\nexample, the Go <a href=\"https://staticcheck.io/docs/checks#SA6005\">staticcheck</a> tool\nfinds expensive string comparisons like:</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">if</span> strings<span class=\"token punctuation\">.</span><span class=\"token function\">ToLower</span><span class=\"token punctuation\">(</span>string1<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> strings<span class=\"token punctuation\">.</span><span class=\"token function\">ToLower</span><span class=\"token punctuation\">(</span>string2<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>and suggests instead:</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">if</span> strings<span class=\"token punctuation\">.</span><span class=\"token function\">EqualFold</span><span class=\"token punctuation\">(</span>string1<span class=\"token punctuation\">,</span> string2<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>These short-and-sweet replacements are a great way to learn framework\nidioms or library functions, like <code class=\"language-text\">strings.EqualFold</code> in Go.<sup>1</sup> And as a\ncodebase grows, small inefficiencies like this one, and inconsistencies\nopportunities compound. Code patterns creep in that affect readability and\nperformance—and <a href=\"https://www.digitalocean.com/blog/how-to-efficiently-compare-strings-in-go/?\">it matters</a>.</p>\n<h2 id=\"Running-code-checks-quickly-easily-and-comprehensively\" style=\"position:relative;\"><a href=\"#Running-code-checks-quickly-easily-and-comprehensively\" aria-label=\"Running code checks quickly easily and comprehensively permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 18 95 120\" height=\"18\" width=\"18\"><path d=\"M53.69,78.7H37.94l-5.85,25H21.74l5.85-25H15.89L18,69.1H29.84l4.65-19.65H23.39l2.1-9.6H36.74l5.7-23.7H52.79l-5.7,23.7H62.84l5.7-23.7H78.89l-5.7,23.7H84.74l-2.4,9.6H70.94L66.29,69.1H77.24l-2.4,9.6H64l-5.85,25H47.84Zm-13.5-9.6H55.94l4.65-19.65H44.84Z\"/></svg></a>Running code checks quickly, easily, and comprehensively</h2>\n<p>Tools like <code class=\"language-text\">staticcheck</code> and linters need setting up: a local clone or project\nbuild on your machine, or a continuous integration (CI) or editor set up. When I\nlearn about patterns like <code class=\"language-text\">strings.EqualFold</code>, I want to know where else they\nmight be lurking: in my code, in my team’s code, or in open source projects. To\ndo that I really need a lightweight workflow, not something that needs cloning\nrepositories, CI or editor setup. Too much hassle. What I’m really after is a\nnimble way to find patterns in a bunch of code over many repositories, quickly\nand comprehensively. Something that feels a lot more like searching code than\nrunning analyzers.</p>\n<p>Naturally, a plaintext search with <code class=\"language-text\">grep</code> <em>can</em> find snippets of <code class=\"language-text\">EqualFold</code>\ncalls. In practice though, this plaintext treatment can’t offer the fidelity of\ndedicated checkers that understand more about code structure and type\ninformation. But I believe there’s a midway. What about a lightweight wokflow\nwhere that <code class=\"language-text\">EqualFold</code> check is a simpler but comparably effective <em>search query</em>\nthat could completely eradicate all those inefficient comparisons in my\ncode, my organization’s code, or even all of open source code?</p>\n<h2 id=\"Example-turning-code-checks-into-code-search-queries\" style=\"position:relative;\"><a href=\"#Example-turning-code-checks-into-code-search-queries\" aria-label=\"Example turning code checks into code search queries permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 18 95 120\" height=\"18\" width=\"18\"><path d=\"M53.69,78.7H37.94l-5.85,25H21.74l5.85-25H15.89L18,69.1H29.84l4.65-19.65H23.39l2.1-9.6H36.74l5.7-23.7H52.79l-5.7,23.7H62.84l5.7-23.7H78.89l-5.7,23.7H84.74l-2.4,9.6H70.94L66.29,69.1H77.24l-2.4,9.6H64l-5.85,25H47.84Zm-13.5-9.6H55.94l4.65-19.65H44.84Z\"/></svg></a>Example: turning code checks into code search queries</h2>\n<p>Earlier this year Sourcegraph introduced <a href=\"/blog/going-beyond-regular-expressions-with-structural-code-search/\">structural search</a>\nto search over code syntax. Structural search uses <a href=\"https://comby.dev\">comby</a> to\nimplement a basic building block in traditional code checkers: it interprets\nprograms as concrete syntax trees, not just plaintext.\nUsing file filters and our new support for <code class=\"language-text\">or</code> clauses,\nit’s possible to write configurable code checks as\nself-contained search queries. Let’s explore this idea!</p>\n<p>Here’s a search query inspired by\n<a href=\"https://staticcheck.io/docs/checks#S1003\">a check</a> where <code class=\"language-text\">strings.Index</code>\ncomparisons can be replaced with <code class=\"language-text\">strings.Contains</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">language<span class=\"token punctuation\">:</span>go\n<span class=\"token keyword\">not</span> <span class=\"token builtin\">file</span><span class=\"token punctuation\">:</span>test\n<span class=\"token keyword\">not</span> <span class=\"token builtin\">file</span><span class=\"token punctuation\">:</span>vendor\n<span class=\"token keyword\">not</span> <span class=\"token builtin\">file</span><span class=\"token punctuation\">:</span>Godeps\n\nstrings<span class=\"token punctuation\">.</span>Index<span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token operator\">-</span><span class=\"token number\">1</span>\n\n<span class=\"token keyword\">or</span>\n\nstrings<span class=\"token punctuation\">.</span>Index<span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>=</span> <span class=\"token number\">0</span>\n\n<span class=\"token keyword\">or</span>\n\nstrings<span class=\"token punctuation\">.</span>Index<span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span></code></pre></div>\n<p>This query matches all <code class=\"language-text\">.go</code> files, excluding file paths that contain <code class=\"language-text\">test</code>,\n<code class=\"language-text\">vendor</code>, and <code class=\"language-text\">Godeps</code>. It’s sensible to exclude these file paths if we\nwant to actually propose changes to a project (more on that later). The patterns\n<code class=\"language-text\">strings.Index(..., ....)</code> match syntax of <code class=\"language-text\">strings.Index</code> calls, and the <code class=\"language-text\">...</code>\nellipses are special placeholders that match at least two arguments.<sup>2</sup>\nThe <code class=\"language-text\">or</code> keyword separates individual patterns.</p>\n<p>We can search over the top 100 Go repositories on GitHub (by stars) those by\nadding <code class=\"language-text\">repogroup:go-gh-100</code> to the query. Have a look at some of the results:</p>\n<p><a href=\"https://sourcegraph.com/search/console?q=repogroup%3Ago-gh-100%0Alanguage%3Ago%0Anot%20file%3Atest%0Anot%20file%3Avendor%0Anot%20file%3AGodeps%0Aindex%3Aonly%0A%0A%2F%2F%20Find%20strings.Index%20calls%20that%20can%20be%20replaced%20by%20strings.Contains%0A%2F%2F%20See%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1003%0A%0Astrings.Index(...%2C%20...)%20%3E%20-1%0A%0Aor%0A%0Astrings.Index(...%2C%20...)%20%3E%3D%200%0A%0Aor%0A%0Astrings.Index(...%2C%20...)%20!%3D%20-1\">🔘 Find ways to improve code in popular Go projects ↗</a>\n<br />\n<sup>Side note: our multiline query editor is in a proof-of-concept phase.</sup></p>\n<img src=\"https://storage.googleapis.com/sourcegraph-assets/about.sourcegraph.com/blog/2020/strings-dot-index-hits.png\" style=\"width: 40rem\">\n<p><sup>Some search hits in projects like Go and Kubernetes where a simpler <code class=\"language-text\">strings.Contains</code> can be used instead.</sup></p>\n<p>The query finds matches in some of the most popular Go projects in a\ncouple of seconds. An exhaustive search shows that there are more than 10 matches\nat the time of writing. For this flavor of syntactic change, I have a good sense\nthat these are real hits of code that we can fix up.</p>\n<h2 id=\"Turning-more-code-checks-into-search-queries\" style=\"position:relative;\"><a href=\"#Turning-more-code-checks-into-search-queries\" aria-label=\"Turning more code checks into search queries permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 18 95 120\" height=\"18\" width=\"18\"><path d=\"M53.69,78.7H37.94l-5.85,25H21.74l5.85-25H15.89L18,69.1H29.84l4.65-19.65H23.39l2.1-9.6H36.74l5.7-23.7H52.79l-5.7,23.7H62.84l5.7-23.7H78.89l-5.7,23.7H84.74l-2.4,9.6H70.94L66.29,69.1H77.24l-2.4,9.6H64l-5.85,25H47.84Zm-13.5-9.6H55.94l4.65-19.65H44.84Z\"/></svg></a>Turning more code checks into search queries</h2>\n<p>Because structural search only looks at syntax, it can’t yet operate at the\nlevel of a tool like <code class=\"language-text\">staticcheck</code>, which knows more about static properties\nlike type information and variable scope to implement checks. At the same time,\n<code class=\"language-text\">staticcheck</code> isn’t a search tool, it’s an entire toolset that includes a suite\nof pre-written, high-precision checks that’s very effective in certain\nworkflows, like CI. The question is not necessarily whether a search tool can\nachieve parity with a tool like <code class=\"language-text\">staticcheck</code>. But given the overlap with\nnow-expressible search queries, I wanted to know how this search workflow stacks\nup: how far can we push structural code search to find similarly <em>actionable</em>\ncode checks? I.e., checks that match real cases of code waiting to be improved,\nminus the hassle.</p>\n<h3 id=\"Approach\" style=\"position:relative;\"><a href=\"#Approach\" aria-label=\"Approach permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 18 95 120\" height=\"18\" width=\"18\"><path d=\"M53.69,78.7H37.94l-5.85,25H21.74l5.85-25H15.89L18,69.1H29.84l4.65-19.65H23.39l2.1-9.6H36.74l5.7-23.7H52.79l-5.7,23.7H62.84l5.7-23.7H78.89l-5.7,23.7H84.74l-2.4,9.6H70.94L66.29,69.1H77.24l-2.4,9.6H64l-5.85,25H47.84Zm-13.5-9.6H55.94l4.65-19.65H44.84Z\"/></svg></a>Approach</h3>\n<p>So, taking inspiration from <code class=\"language-text\">staticcheck</code>, I wanted to see how many of its\nchecks translate to search queries that I could have high confidence in (i.e.,\nall patterns find legitimate issues; zero or very-near-zero false positives). I\nchose to look at <code class=\"language-text\">staticcheck</code> for its clear documentation, which made it easy\nto find examples.<sup>3</sup> I ran my search queries against <code class=\"language-text\">staticcheck</code>’s\nown test files to check that they don’t match unintended patterns (false\npositives) and don’t miss real patterns (false negatives). Each check may have\nmore than one syntactic <em>variant</em>, so I tried to implement patterns for as many\nvariants as I could find in tests. It’s a neat exercise to develop patterns\nagainst the reference tests and discover which variants to cover, all in a\nself-contained search webapp. Here’s an example where the query matches all the\ntrue hits in the test file, annotated with <code class=\"language-text\">// want strings.Contains ...</code>:</p>\n<img src=\"https://storage.googleapis.com/sourcegraph-assets/about.sourcegraph.com/blog/2020/multiline-query-editor.png\">\n<p><a href=\"https://sourcegraph.com/search/console?q=repo%3A%5Egithub%5C.com%2Fdominikh%2Fgo-tools%24%20%0Alang%3Ago%0Afile%3Atest%0A%0Astrings.IndexRune(...%2C%20...)%20%3E%20-1%20or%0Astrings.IndexRune(...%2C%20...)%20%3E%3D%200%20or%0Astrings.IndexRune(...%2C%20...)%20!%3D%20-1%20or%0Astrings.IndexRune(...%2C%20...)%20%3D%3D%20-1%20or%0Astrings.IndexRune(...%2C%20...)%20%3C%200%20or%0Astrings.IndexAny(...%2C%20...)%20%3E%20-1%20or%0Astrings.IndexAny(...%2C%20...)%20%3E%3D%200%20or%0Astrings.IndexAny(...%2C%20...)%20!%3D%20-1%20or%0Astrings.IndexAny(...%2C%20...)%20%3D%3D%20-1%20or%0Astrings.IndexAny(...%2C%20...)%20%3C%200%20or%0Astrings.Index(...%2C%20...)%20%3E%20-1%20or%0Astrings.Index(...%2C%20...)%20%3E%3D%200%20or%0Astrings.Index(...%2C%20...)%20!%3D%20-1%20or%0Astrings.Index(...%2C%20...)%20%3D%3D%20-1%20or%0Astrings.Index(...%2C%20...)%20%3C%200%0A\">🔘 Example query to match known patterns in test files↗</a></p>\n<p>Using the test files isn’t a guarantee that I’ve implemented all the checks or\nthat it’s entirely precise, but it adds a lot more confidence than inferring\npatterns only from documentation.</p>\n<h3 id=\"Results\" style=\"position:relative;\"><a href=\"#Results\" aria-label=\"Results permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 18 95 120\" height=\"18\" width=\"18\"><path d=\"M53.69,78.7H37.94l-5.85,25H21.74l5.85-25H15.89L18,69.1H29.84l4.65-19.65H23.39l2.1-9.6H36.74l5.7-23.7H52.79l-5.7,23.7H62.84l5.7-23.7H78.89l-5.7,23.7H84.74l-2.4,9.6H70.94L66.29,69.1H77.24l-2.4,9.6H64l-5.85,25H47.84Zm-13.5-9.6H55.94l4.65-19.65H44.84Z\"/></svg></a>Results</h3>\n<p>Without making any claims about completeness, I was able to implement\nat least one variant for 20 out of 34 checks that I feel confident\nabout. I relied only on patterns in <code class=\"language-text\">staticcheck</code>’s test data to discover syntactic\nvariants for checks, so I don’t know if I covered all the patterns that\n<code class=\"language-text\">staticcheck</code> implements in its code.</p>\n<p>The majority of checks that I couldn’t write required type information to\nimplement correctly (13 of 34). Other checks I couldn’t write required more\ncomplex syntax matching rules (8 of 34). This table roughly quantifies the\nexpressive needs for implementing checks:</p>\n<table>\n<thead>\n<tr>\n<th>Description</th>\n<th># of checks</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Total</td>\n<td>34</td>\n</tr>\n<tr>\n<td>Works (at least one variant)</td>\n<td>20</td>\n</tr>\n<tr>\n<td>Works (all variants)</td>\n<td>11</td>\n</tr>\n<tr>\n<td>Needs type info</td>\n<td>13</td>\n</tr>\n<tr>\n<td>Needs additional syntax matching</td>\n<td>8</td>\n</tr>\n</tbody>\n</table>\n<p><sup>Note that some checks require type info <em>and</em> additional syntax matching.\nAlso, one working variant for a check may not require type info, but another\nvariant for the same check may. I.e., the values overlap and do not sum to\nTotal.</sup></p>\n<p>You can see and run the final query here:</p>\n<p><a href=\"https://sourcegraph.com/search/console?q=repogroup%3Ago-gh-100%0Alang%3Ago%0Anot%20file%3Atest%0Anot%20file%3Avendor%0Anot%20file%3AGodeps%0Aindex%3Aonly%0A%0A%2F%2F%20Inefficient%20string%20comparison%20with%20strings.ToLower%20or%20strings.ToUpper%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23SA6005%0Aif%20strings.ToLower(...)%20%3D%3D%20strings.ToLower(...)%20or%0Aif%20strings.ToLower(...)%20!%3D%20strings.ToLower(...)%20or%0Aif%20strings.ToUpper(...)%20%3D%3D%20strings.ToUpper(...)%20or%0Aif%20strings.ToUpper(...)%20!%3D%20strings.ToUpper(...)%20or%0A%0A%2F%2F%20Replace%20call%20to%20strings.Index%20with%20strings.Contains%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1003%0Astrings.IndexRune(...%2C%20...)%20%3E%20-1%20or%0Astrings.IndexRune(...%2C%20...)%20%3E%3D%200%20or%0Astrings.IndexRune(...%2C%20...)%20!%3D%20-1%20or%0Astrings.IndexRune(...%2C%20...)%20%3D%3D%20-1%20or%0Astrings.IndexRune(...%2C%20...)%20%3C%200%20or%0Astrings.IndexAny(...%2C%20...)%20%3E%20-1%20or%0Astrings.IndexAny(...%2C%20...)%20%3E%3D%200%20or%0Astrings.IndexAny(...%2C%20...)%20!%3D%20-1%20or%0Astrings.IndexAny(...%2C%20...)%20%3D%3D%20-1%20or%0Astrings.IndexAny(...%2C%20...)%20%3C%200%20or%0Astrings.Index(...%2C%20...)%20%3E%20-1%20or%0Astrings.Index(...%2C%20...)%20%3E%3D%200%20or%0Astrings.Index(...%2C%20...)%20!%3D%20-1%20or%0Astrings.Index(...%2C%20...)%20%3D%3D%20-1%20or%0Astrings.Index(...%2C%20...)%20%3C%200%20or%0A%0A%2F%2F%20Replace%20call%20to%20bytes.Compare%20with%20bytes.Equal%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1004%0Abytes.Compare(...%2C%20...)%20%3D%3D%200%20or%0Abytes.Compare(...%2C%20...)%20!%3D%200%20or%0A%0A%2F%2F%20Drop%20unnecessary%20use%20of%20the%20blank%20identifier%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1005%0Afor%20%3A%5B~_%5D%2C%20%3A%5B~_%5D%20%3D%20range%20or%0Afor%20%3A%5B~_%5D%20%3D%20range%20or%0A%0A%2F%2F%20Use%20for%20%7B%20...%20%7D%20for%20infinite%20loops%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1006%0Afor%20true%20%7B...%7D%20or%0A%0A%2F%2F%20Omit%20default%20slice%20index%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1010%0A%3A%5Bs.%5D%5B%3Alen(%3A%5Bs%5D)%5D%20or%0A%0A%2F%2F%20Replace%20time.Now().Sub(x)%20with%20time.Since(x)%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1012%0Atime.Now().Sub(...)%20or%0A%0A%2F%2F%20Use%20copy%20for%20sliding%20elements%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1018%0Afor%20%3A%5Bi.%5D%20%3A%3D%200%3B%20%3A%5Bi.%5D%20%3C%20%3A%5Bn.%5D%3B%20%3A%5Bi.%5D%20%20%20%7B%0A%20%20%3A%5Bbs.%5D%5B%3A%5Bi%5D%5D%20%3D%20%3A%5Bbs.%5D%5B%3A%5Boffset.%5D%20%3A%5Bi.%5D%5D%0A%7D%0A%0Aor%0A%0A%2F%2F%20Simplify%20make%20call%20by%20omitting%20redundant%20arguments%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1019%0Amake(...%2C%20%3A%5Bx%5D%2C%20%3A%5Bx%5D)%20or%20%0Amake(map%5B%3A%5B%5Bw%5D%5D%5D%3A%5B%5Bw%5D%5D%2C%200)%20or%0Amake(chan%20int%2C%200)%20or%0A%0A%2F%2F%20Omit%20redundant%20nil%20check%20in%20type%20assertion%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1020%0Aif%20%3A%5B_.%5D%2C%20ok%20%3A%3D%20%3A%5Bi.%5D.(%3A%5BT%5D)%3B%20ok%20%26%26%20%3A%5Bi.%5D%20!%3D%20nil%20%7B%20...%20%7D%20or%0Aif%20%3A%5B_.%5D%2C%20ok%20%3A%3D%20%3A%5Bi.%5D.(%3A%5BT%5D)%3B%20%3A%5Bi.%5D%20!%3D%20nil%20%26%26%20ok%20%7B%20...%20%7D%20or%0A%0Aif%20%3A%5Bi.%5D%20!%3D%20nil%20%7B%0A%20%20if%20%3A%5B_.%5D%2C%20ok%20%3A%3D%20%3A%5Bi.%5D.(%3A%5BT%5D)%3B%20ok%20%7B%20...%20%7D%0A%7D%0A%0Aor%0A%0A%2F%2F%20Omit%20redundant%20control%20flow%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1023%0Afunc%20%3A%5Bfn.%5D(...)%20%7B...%20return%20%7D%20%20or%20%0Afunc()%20%7B...%20return%20%7D%20or%0A%0A%2F%2F%20Replace%20x.Sub(time.Now())%20with%20time.Until(x)%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1024%0A.Sub(time.Now())%20or%0A%0A%2F%2F%20Don%27t%20use%20fmt.Sprintf(%22%25s%22%2C%20x)%20unnecessarily%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1025%0Afmt.Println(%22%25s%22%2C%20%22...%22)%20or%0A%0A%2F%2F%20Simplify%20error%20construction%20with%20fmt.Errorf%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1028%0Aerrors.New(fmt.Sprintf(...))%20or%0A%0A%2F%2F%20Range%20over%20the%20string%20directly%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1029%0Afor%20%3A%5B~_%5D%2C%20%3A%5B_.%5D%20%3A%3D%20range%20%5B%5Drune(...)%20or%0A%0A%2F%2F%20Use%20sort.Ints(x)%2C%20sort.Float64s(x)%2C%20and%20sort.Strings(x)%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1032%0Asort.Sort(sort.IntSlice(...))%20or%0Asort.Sort(sort.Float64Slice(...))%20or%0Asort.Sort(sort.StringSlice(...))%20or%0A%0A%2F%2F%20Redundant%20call%20to%20net%2Fhttp.CanonicalHeaderKey%20in%20method%20call%20on%20net%2Fhttp.Header%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1035%0Aheaders.Add(http.CanonicalHeaderKey(...)%2C%20...)%20or%0Aheaders.Del(http.CanonicalHeaderKey(...))%20or%0Aheaders.Get(http.CanonicalHeaderKey(...))%20or%0Aheaders.Set(http.CanonicalHeaderKey(...)%2C%20...)%20or%0A%0A%2F%2F%20Unnecessary%20guard%20around%20map%20access%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1036%0Aif%20%3A%5B~_%5D%2C%20ok%20%3A%3D%20%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%3B%20ok%20%7B%0A%20%20%20%20%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%20%2B%3D%20%3A%5Bx.%5D%0A%7D%20else%20%7B%0A%20%20%20%20%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%20%3D%20%3A%5Bx.%5D%0A%7D%0A%0Aor%0A%0Aif%20%3A%5B~_%5D%2C%20ok%20%3A%3D%20%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%3B%20ok%20%7B%0A%20%20%20%20%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%2B%2B%0A%7D%20else%20%7B%0A%20%20%20%20%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%20%3D%201%0A%7D%0A%0Aor%0A%0Aif%20%3A%5B~_%5D%2C%20ok%20%3A%3D%20%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%3B%20ok%20%7B%0A%09%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%20%3D%20append(%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%2C%20%22%3A%5Bv1%5D%22)%0A%7D%20else%20%7B%0A%09%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%20%3D%20%5B%5Dstring%7B%22%3A%5Bv1%5D%22%7D%0A%7D%0A%0Aor%0A%0Aif%20%3A%5B~_%5D%2C%20ok%20%3A%3D%20%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%3B%20ok%20%7B%0A%09%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%20%3D%20append(%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%2C%20%22%3A%5Bv1%5D%22%2C%20%22%3A%5Bv2%5D%22)%0A%7D%20else%20%7B%0A%09%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%20%3D%20%5B%5Dstring%7B%22%3A%5Bv1%5D%22%2C%20%22%3A%5Bv2%5D%22%7D%0A%7D%0A%0Aor%0A%0A%2F%2F%20Elaborate%20way%20of%20sleeping%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1037%0Aselect%20%7B%0A%09case%20%3C-time.After(0)%3A%0A%7D%0A%0Aor%0A%0A%2F%2F%20Unnecessarily%20complex%20way%20of%20printing%20formatted%20string%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1038%0Afmt.Print(fmt.Sprintf(%22...%22%2C%20...))%20or%0Afmt.Println(fmt.Sprintf(%22...%22%2C%20...))%20or%0Afmt.Fprint(nil%2C%20fmt.Sprintf(%22...%22%2C%20...))%20or%0Afmt.Fprintln(nil%2C%20fmt.Sprintf(%22...%22%2C%20...))%20or%0Afmt.Sprint(fmt.Sprintf(%22...%22%2C%20...))%20or%0Afmt.Sprintln(fmt.Sprintf(%22...%22%2C%20...))%20or%20%0A%0A%2F%2F%20Unnecessary%20use%20of%20fmt.Sprint%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1039%0Afmt.Sprintf(%22%25s%22%2C%20%22...%22)\">🔘 Run the query for all code checks on popular Go projects ↗</a>\n<br />\n<sup>Side note: patterns run in order and search stops after finding at least 30 matches. Feel free to delete some patterns to see others in action.</sup></p>\n<p>It was tempting to compare more directly by downloading the\n100 Go repositories to disk, running <code class=\"language-text\">staticcheck</code>, and comparing matches.\nFor <code class=\"language-text\">staticcheck</code> to be effective, the project typically needs to be built first\n(my experience was that running <code class=\"language-text\">staticcheck</code> on individual files can be\nhit-and-miss, and understandably so). I didn’t like the idea of doing all that\nwork, so I punted. That’s really the takeaway of these results: many useful checks can fit into\na lightweight search workflow that scales and generalizes to a lot of projects, without\nad-hoc setup for project builds and dedicated tools.<sup>5</sup></p>\n<p>Extending search queries to access static properties like type information is a also\nnatural extension for writing better code checks, and an area of <a href=\"https://docs.sourcegraph.com/code_intelligence\">code intelligence</a>\nwork that we’re exploring.</p>\n<h3 id=\"Code-checks-beyond-dedicated-tools\" style=\"position:relative;\"><a href=\"#Code-checks-beyond-dedicated-tools\" aria-label=\"Code checks beyond dedicated tools permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 18 95 120\" height=\"18\" width=\"18\"><path d=\"M53.69,78.7H37.94l-5.85,25H21.74l5.85-25H15.89L18,69.1H29.84l4.65-19.65H23.39l2.1-9.6H36.74l5.7-23.7H52.79l-5.7,23.7H62.84l5.7-23.7H78.89l-5.7,23.7H84.74l-2.4,9.6H70.94L66.29,69.1H77.24l-2.4,9.6H64l-5.85,25H47.84Zm-13.5-9.6H55.94l4.65-19.65H44.84Z\"/></svg></a>Code checks beyond dedicated tools</h3>\n<p>The direct comparison to <code class=\"language-text\">staticcheck</code> is interesting, but the ease of\na search workflow means there are also different benefits over dedicated tools. For\nexample, in just the last couple of weeks I learned about a more elegant way to\nwrite code for <a href=\"https://golang.org/ref/spec#Appending_and_copying_slices\">appending bytes in Go</a>.\nA pattern like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\">b <span class=\"token operator\">=</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> <span class=\"token string\">'f'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'o'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'o'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>can instead be written:</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\">b <span class=\"token operator\">=</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> <span class=\"token string\">\"foo\"</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>This one isn’t available in <code class=\"language-text\">staticcheck</code>, but I could immediately implement the check and find hits using Sourcegraph:</p>\n<p><a href=\"https://sourcegraph.com/search?q=repogroup:go-gh-100+lang:go+index:only+append%28...%2C+%27...%27%2C+%27...%27%2C+%27...%27%29&#x26;patternType=structural\">🔘 Find appends of three or more bytes ↗</a></p>\n<p>There’s also the notion of project-specific checks\nthat will never make it into a general tool like <code class=\"language-text\">staticcheck</code>. For example, in\nour Sourcegraph codebase we’ve mostly moved away from testing values with <code class=\"language-text\">!=</code> and\ninstead use <a href=\"https://godoc.org/github.com/google/go-cmp/cmp#Diff\"><code class=\"language-text\">cmp.Diff</code></a>.\nBut I know there are still places where we do comparisons the old way. This\nquery highlights some of the remnants, and how how the inner block uses the\ncompared values:</p>\n<p><a href=\"https://sourcegraph.com/search?q=repo:%5Egithub%5C.com/sourcegraph/sourcegraph%24+file:test+if+want+%21%3D+got+%7B...%7D&#x26;patternType=structural\">🔘 file:test if want != got {…} ↗</a></p>\n<p>So code checks can also be specific and customizable to your organization that\nyou won’t find in off-the-shelf tools.</p>\n<h2 id=\"Takeaway\" style=\"position:relative;\"><a href=\"#Takeaway\" aria-label=\"Takeaway permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 18 95 120\" height=\"18\" width=\"18\"><path d=\"M53.69,78.7H37.94l-5.85,25H21.74l5.85-25H15.89L18,69.1H29.84l4.65-19.65H23.39l2.1-9.6H36.74l5.7-23.7H52.79l-5.7,23.7H62.84l5.7-23.7H78.89l-5.7,23.7H84.74l-2.4,9.6H70.94L66.29,69.1H77.24l-2.4,9.6H64l-5.85,25H47.84Zm-13.5-9.6H55.94l4.65-19.65H44.84Z\"/></svg></a>Takeaway</h2>\n<p>Code search can be so much more than finding your favorite provider called\n<code class=\"language-text\">ChocolateCake</code> identifier<a href=\"https://sourcegraph.com/search?q=ChocolateCake&#x26;patternType=literal\">↗</a>.\nIt can be a lightweight workflow for revealing short-and-sweet ways to make your\ncode better. Perhaps the most powerful idea is that a universal code search can\nwholesale find and eradicate the code slips we’re always bound to make.</p>\n<p>Starting small, the solution could look like a search query that finds issues in\nactive and popular Go projects at just the push of a button. Why not start\nthere? I’m excited about the idea that we can run that query for everything\nat once:</p>\n<p><a href=\"https://sourcegraph.com/search/console?q=repogroup%3Ago-gh-100%0Alang%3Ago%0Anot%20file%3Atest%0Anot%20file%3Avendor%0Anot%20file%3AGodeps%0Aindex%3Aonly%0A%0A%2F%2F%20Inefficient%20string%20comparison%20with%20strings.ToLower%20or%20strings.ToUpper%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23SA6005%0Aif%20strings.ToLower(...)%20%3D%3D%20strings.ToLower(...)%20or%0Aif%20strings.ToLower(...)%20!%3D%20strings.ToLower(...)%20or%0Aif%20strings.ToUpper(...)%20%3D%3D%20strings.ToUpper(...)%20or%0Aif%20strings.ToUpper(...)%20!%3D%20strings.ToUpper(...)%20or%0A%0A%2F%2F%20Replace%20call%20to%20strings.Index%20with%20strings.Contains%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1003%0Astrings.IndexRune(...%2C%20...)%20%3E%20-1%20or%0Astrings.IndexRune(...%2C%20...)%20%3E%3D%200%20or%0Astrings.IndexRune(...%2C%20...)%20!%3D%20-1%20or%0Astrings.IndexRune(...%2C%20...)%20%3D%3D%20-1%20or%0Astrings.IndexRune(...%2C%20...)%20%3C%200%20or%0Astrings.IndexAny(...%2C%20...)%20%3E%20-1%20or%0Astrings.IndexAny(...%2C%20...)%20%3E%3D%200%20or%0Astrings.IndexAny(...%2C%20...)%20!%3D%20-1%20or%0Astrings.IndexAny(...%2C%20...)%20%3D%3D%20-1%20or%0Astrings.IndexAny(...%2C%20...)%20%3C%200%20or%0Astrings.Index(...%2C%20...)%20%3E%20-1%20or%0Astrings.Index(...%2C%20...)%20%3E%3D%200%20or%0Astrings.Index(...%2C%20...)%20!%3D%20-1%20or%0Astrings.Index(...%2C%20...)%20%3D%3D%20-1%20or%0Astrings.Index(...%2C%20...)%20%3C%200%20or%0A%0A%2F%2F%20Replace%20call%20to%20bytes.Compare%20with%20bytes.Equal%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1004%0Abytes.Compare(...%2C%20...)%20%3D%3D%200%20or%0Abytes.Compare(...%2C%20...)%20!%3D%200%20or%0A%0A%2F%2F%20Drop%20unnecessary%20use%20of%20the%20blank%20identifier%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1005%0Afor%20%3A%5B~_%5D%2C%20%3A%5B~_%5D%20%3D%20range%20or%0Afor%20%3A%5B~_%5D%20%3D%20range%20or%0A%0A%2F%2F%20Use%20for%20%7B%20...%20%7D%20for%20infinite%20loops%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1006%0Afor%20true%20%7B...%7D%20or%0A%0A%2F%2F%20Omit%20default%20slice%20index%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1010%0A%3A%5Bs.%5D%5B%3Alen(%3A%5Bs%5D)%5D%20or%0A%0A%2F%2F%20Replace%20time.Now().Sub(x)%20with%20time.Since(x)%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1012%0Atime.Now().Sub(...)%20or%0A%0A%2F%2F%20Use%20copy%20for%20sliding%20elements%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1018%0Afor%20%3A%5Bi.%5D%20%3A%3D%200%3B%20%3A%5Bi.%5D%20%3C%20%3A%5Bn.%5D%3B%20%3A%5Bi.%5D%20%20%20%7B%0A%20%20%3A%5Bbs.%5D%5B%3A%5Bi%5D%5D%20%3D%20%3A%5Bbs.%5D%5B%3A%5Boffset.%5D%20%3A%5Bi.%5D%5D%0A%7D%0A%0Aor%0A%0A%2F%2F%20Simplify%20make%20call%20by%20omitting%20redundant%20arguments%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1019%0Amake(...%2C%20%3A%5Bx%5D%2C%20%3A%5Bx%5D)%20or%20%0Amake(map%5B%3A%5B%5Bw%5D%5D%5D%3A%5B%5Bw%5D%5D%2C%200)%20or%0Amake(chan%20int%2C%200)%20or%0A%0A%2F%2F%20Omit%20redundant%20nil%20check%20in%20type%20assertion%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1020%0Aif%20%3A%5B_.%5D%2C%20ok%20%3A%3D%20%3A%5Bi.%5D.(%3A%5BT%5D)%3B%20ok%20%26%26%20%3A%5Bi.%5D%20!%3D%20nil%20%7B%20...%20%7D%20or%0Aif%20%3A%5B_.%5D%2C%20ok%20%3A%3D%20%3A%5Bi.%5D.(%3A%5BT%5D)%3B%20%3A%5Bi.%5D%20!%3D%20nil%20%26%26%20ok%20%7B%20...%20%7D%20or%0A%0Aif%20%3A%5Bi.%5D%20!%3D%20nil%20%7B%0A%20%20if%20%3A%5B_.%5D%2C%20ok%20%3A%3D%20%3A%5Bi.%5D.(%3A%5BT%5D)%3B%20ok%20%7B%20...%20%7D%0A%7D%0A%0Aor%0A%0A%2F%2F%20Omit%20redundant%20control%20flow%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1023%0Afunc%20%3A%5Bfn.%5D(...)%20%7B...%20return%20%7D%20%20or%20%0Afunc()%20%7B...%20return%20%7D%20or%0A%0A%2F%2F%20Replace%20x.Sub(time.Now())%20with%20time.Until(x)%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1024%0A.Sub(time.Now())%20or%0A%0A%2F%2F%20Don%27t%20use%20fmt.Sprintf(%22%25s%22%2C%20x)%20unnecessarily%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1025%0Afmt.Println(%22%25s%22%2C%20%22...%22)%20or%0A%0A%2F%2F%20Simplify%20error%20construction%20with%20fmt.Errorf%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1028%0Aerrors.New(fmt.Sprintf(...))%20or%0A%0A%2F%2F%20Range%20over%20the%20string%20directly%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1029%0Afor%20%3A%5B~_%5D%2C%20%3A%5B_.%5D%20%3A%3D%20range%20%5B%5Drune(...)%20or%0A%0A%2F%2F%20Use%20sort.Ints(x)%2C%20sort.Float64s(x)%2C%20and%20sort.Strings(x)%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1032%0Asort.Sort(sort.IntSlice(...))%20or%0Asort.Sort(sort.Float64Slice(...))%20or%0Asort.Sort(sort.StringSlice(...))%20or%0A%0A%2F%2F%20Redundant%20call%20to%20net%2Fhttp.CanonicalHeaderKey%20in%20method%20call%20on%20net%2Fhttp.Header%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1035%0Aheaders.Add(http.CanonicalHeaderKey(...)%2C%20...)%20or%0Aheaders.Del(http.CanonicalHeaderKey(...))%20or%0Aheaders.Get(http.CanonicalHeaderKey(...))%20or%0Aheaders.Set(http.CanonicalHeaderKey(...)%2C%20...)%20or%0A%0A%2F%2F%20Unnecessary%20guard%20around%20map%20access%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1036%0Aif%20%3A%5B~_%5D%2C%20ok%20%3A%3D%20%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%3B%20ok%20%7B%0A%20%20%20%20%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%20%2B%3D%20%3A%5Bx.%5D%0A%7D%20else%20%7B%0A%20%20%20%20%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%20%3D%20%3A%5Bx.%5D%0A%7D%0A%0Aor%0A%0Aif%20%3A%5B~_%5D%2C%20ok%20%3A%3D%20%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%3B%20ok%20%7B%0A%20%20%20%20%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%2B%2B%0A%7D%20else%20%7B%0A%20%20%20%20%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%20%3D%201%0A%7D%0A%0Aor%0A%0Aif%20%3A%5B~_%5D%2C%20ok%20%3A%3D%20%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%3B%20ok%20%7B%0A%09%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%20%3D%20append(%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%2C%20%22%3A%5Bv1%5D%22)%0A%7D%20else%20%7B%0A%09%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%20%3D%20%5B%5Dstring%7B%22%3A%5Bv1%5D%22%7D%0A%7D%0A%0Aor%0A%0Aif%20%3A%5B~_%5D%2C%20ok%20%3A%3D%20%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%3B%20ok%20%7B%0A%09%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%20%3D%20append(%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%2C%20%22%3A%5Bv1%5D%22%2C%20%22%3A%5Bv2%5D%22)%0A%7D%20else%20%7B%0A%09%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%20%3D%20%5B%5Dstring%7B%22%3A%5Bv1%5D%22%2C%20%22%3A%5Bv2%5D%22%7D%0A%7D%0A%0Aor%0A%0A%2F%2F%20Elaborate%20way%20of%20sleeping%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1037%0Aselect%20%7B%0A%09case%20%3C-time.After(0)%3A%0A%7D%0A%0Aor%0A%0A%2F%2F%20Unnecessarily%20complex%20way%20of%20printing%20formatted%20string%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1038%0Afmt.Print(fmt.Sprintf(%22...%22%2C%20...))%20or%0Afmt.Println(fmt.Sprintf(%22...%22%2C%20...))%20or%0Afmt.Fprint(nil%2C%20fmt.Sprintf(%22...%22%2C%20...))%20or%0Afmt.Fprintln(nil%2C%20fmt.Sprintf(%22...%22%2C%20...))%20or%0Afmt.Sprint(fmt.Sprintf(%22...%22%2C%20...))%20or%0Afmt.Sprintln(fmt.Sprintf(%22...%22%2C%20...))%20or%20%0A%0A%2F%2F%20Unnecessary%20use%20of%20fmt.Sprint%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1039%0Afmt.Sprintf(%22%25s%22%2C%20%22...%22)\">🔘 Run all the code checks on popular Go projects ↗</a>\n<br /></p>\n<p>The great thing about code checks as queries is that it’s easy to simply\ndelete patterns that we don’t find as valuable. When I explored some\nindividual queries, it was also reassuring to discover that <em>no</em> patterns occur\nin any of the Go repositories. For example,\n<a href=\"https://staticcheck.io/docs/checks#S1035\">S1035</a> checks that there are unneeded\n<code class=\"language-text\">http.CanonicalHeaderKey</code> calls on the first argument of certain functions:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">headers<span class=\"token punctuation\">.</span>Add<span class=\"token punctuation\">(</span>http<span class=\"token punctuation\">.</span>CanonicalHeaderKey<span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span>\nheaders<span class=\"token punctuation\">.</span>Del<span class=\"token punctuation\">(</span>http<span class=\"token punctuation\">.</span>CanonicalHeaderKey<span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span>\nheaders<span class=\"token punctuation\">.</span>Get<span class=\"token punctuation\">(</span>http<span class=\"token punctuation\">.</span>CanonicalHeaderKey<span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span>\nheaders<span class=\"token punctuation\">.</span>Set<span class=\"token punctuation\">(</span>http<span class=\"token punctuation\">.</span>CanonicalHeaderKey<span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>There are <a href=\"https://sourcegraph.com/search/console?q=repogroup%3Ago-gh-100%0Alang%3Ago%0Anot%20file%3Atest%0Anot%20file%3Avendor%0Anot%20file%3AGodeps%0Aindex%3Aonly%0A%0A%2F%2F%20Good%20thing%3A%20there%20are%20no%20matches%20for%20these%20patterns%20in%20the%20top%20100%20Go%20repositories%0Aheaders.Add(http.CanonicalHeaderKey(...)%2C%20...)%20or%0Aheaders.Del(http.CanonicalHeaderKey(...))%20or%0Aheaders.Get(http.CanonicalHeaderKey(...))%20or%0Aheaders.Set(http.CanonicalHeaderKey(...)%2C%20...)\">no matches ↗</a> for this pattern in the Go repositories, but there are <a href=\"https://sourcegraph.com/search/console?q=repogroup%3Ago-gh-100%0Alang%3Ago%0Anot%20file%3Atest%0Aindex%3Aonly%0A%0A%2F%2F%20There%20are%20some%20matches%20for%20these%20patterns%20in%20vendored%20files%0Aheaders.Add(http.CanonicalHeaderKey(...)%2C%20...)%20or%0Aheaders.Del(http.CanonicalHeaderKey(...))%20or%0Aheaders.Get(http.CanonicalHeaderKey(...))%20or%0Aheaders.Set(http.CanonicalHeaderKey(...)%2C%20...)\">some matches ↗</a> in vendored files, when we we remove the <code class=\"language-text\">not file:vendor</code> filter.</p>\n<h3 id=\"Proposing-changes\" style=\"position:relative;\"><a href=\"#Proposing-changes\" aria-label=\"Proposing changes permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 18 95 120\" height=\"18\" width=\"18\"><path d=\"M53.69,78.7H37.94l-5.85,25H21.74l5.85-25H15.89L18,69.1H29.84l4.65-19.65H23.39l2.1-9.6H36.74l5.7-23.7H52.79l-5.7,23.7H62.84l5.7-23.7H78.89l-5.7,23.7H84.74l-2.4,9.6H70.94L66.29,69.1H77.24l-2.4,9.6H64l-5.85,25H47.84Zm-13.5-9.6H55.94l4.65-19.65H44.84Z\"/></svg></a>Proposing changes</h3>\n<p>The most exciting part of finding real hits with any code checking tool is that\nwe discover an <em>actionable</em> way to improve the code! I’ve narrowed down the\nsearch query so that it (hopefully) finds only real and uncontroversial patterns\nto improve and contribute to active Go projects.</p>\n<p>Part of an effective contribution means that we need to avoid matches in files\nthat are tests, vendored, or external dependencies. While anyone can use the\nresults to make contributions, it’s important to be mindful of contributor\nguidelines, clearly communicate and motivate proposed changes in pull requests,\nand validate that the change passes a project’s tests or CI checks. And, while the\nquery does exclude common test and vendored files, it’s best to check that\nmatches occur in files that really are part of the project.</p>\n<p>If you’re interested in turning the results of <a href=\"https://sourcegraph.com/search/console?q=repogroup%3Ago-gh-100%0Alang%3Ago%0Anot%20file%3Atest%0Anot%20file%3Avendor%0Anot%20file%3AGodeps%0Aindex%3Aonly%0A%0A%2F%2F%20Inefficient%20string%20comparison%20with%20strings.ToLower%20or%20strings.ToUpper%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23SA6005%0Aif%20strings.ToLower(...)%20%3D%3D%20strings.ToLower(...)%20or%0Aif%20strings.ToLower(...)%20!%3D%20strings.ToLower(...)%20or%0Aif%20strings.ToUpper(...)%20%3D%3D%20strings.ToUpper(...)%20or%0Aif%20strings.ToUpper(...)%20!%3D%20strings.ToUpper(...)%20or%0A%0A%2F%2F%20Replace%20call%20to%20strings.Index%20with%20strings.Contains%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1003%0Astrings.IndexRune(...%2C%20...)%20%3E%20-1%20or%0Astrings.IndexRune(...%2C%20...)%20%3E%3D%200%20or%0Astrings.IndexRune(...%2C%20...)%20!%3D%20-1%20or%0Astrings.IndexRune(...%2C%20...)%20%3D%3D%20-1%20or%0Astrings.IndexRune(...%2C%20...)%20%3C%200%20or%0Astrings.IndexAny(...%2C%20...)%20%3E%20-1%20or%0Astrings.IndexAny(...%2C%20...)%20%3E%3D%200%20or%0Astrings.IndexAny(...%2C%20...)%20!%3D%20-1%20or%0Astrings.IndexAny(...%2C%20...)%20%3D%3D%20-1%20or%0Astrings.IndexAny(...%2C%20...)%20%3C%200%20or%0Astrings.Index(...%2C%20...)%20%3E%20-1%20or%0Astrings.Index(...%2C%20...)%20%3E%3D%200%20or%0Astrings.Index(...%2C%20...)%20!%3D%20-1%20or%0Astrings.Index(...%2C%20...)%20%3D%3D%20-1%20or%0Astrings.Index(...%2C%20...)%20%3C%200%20or%0A%0A%2F%2F%20Replace%20call%20to%20bytes.Compare%20with%20bytes.Equal%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1004%0Abytes.Compare(...%2C%20...)%20%3D%3D%200%20or%0Abytes.Compare(...%2C%20...)%20!%3D%200%20or%0A%0A%2F%2F%20Drop%20unnecessary%20use%20of%20the%20blank%20identifier%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1005%0Afor%20%3A%5B~_%5D%2C%20%3A%5B~_%5D%20%3D%20range%20or%0Afor%20%3A%5B~_%5D%20%3D%20range%20or%0A%0A%2F%2F%20Use%20for%20%7B%20...%20%7D%20for%20infinite%20loops%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1006%0Afor%20true%20%7B...%7D%20or%0A%0A%2F%2F%20Omit%20default%20slice%20index%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1010%0A%3A%5Bs.%5D%5B%3Alen(%3A%5Bs%5D)%5D%20or%0A%0A%2F%2F%20Replace%20time.Now().Sub(x)%20with%20time.Since(x)%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1012%0Atime.Now().Sub(...)%20or%0A%0A%2F%2F%20Use%20copy%20for%20sliding%20elements%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1018%0Afor%20%3A%5Bi.%5D%20%3A%3D%200%3B%20%3A%5Bi.%5D%20%3C%20%3A%5Bn.%5D%3B%20%3A%5Bi.%5D%20%20%20%7B%0A%20%20%3A%5Bbs.%5D%5B%3A%5Bi%5D%5D%20%3D%20%3A%5Bbs.%5D%5B%3A%5Boffset.%5D%20%3A%5Bi.%5D%5D%0A%7D%0A%0Aor%0A%0A%2F%2F%20Simplify%20make%20call%20by%20omitting%20redundant%20arguments%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1019%0Amake(...%2C%20%3A%5Bx%5D%2C%20%3A%5Bx%5D)%20or%20%0Amake(map%5B%3A%5B%5Bw%5D%5D%5D%3A%5B%5Bw%5D%5D%2C%200)%20or%0Amake(chan%20int%2C%200)%20or%0A%0A%2F%2F%20Omit%20redundant%20nil%20check%20in%20type%20assertion%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1020%0Aif%20%3A%5B_.%5D%2C%20ok%20%3A%3D%20%3A%5Bi.%5D.(%3A%5BT%5D)%3B%20ok%20%26%26%20%3A%5Bi.%5D%20!%3D%20nil%20%7B%20...%20%7D%20or%0Aif%20%3A%5B_.%5D%2C%20ok%20%3A%3D%20%3A%5Bi.%5D.(%3A%5BT%5D)%3B%20%3A%5Bi.%5D%20!%3D%20nil%20%26%26%20ok%20%7B%20...%20%7D%20or%0A%0Aif%20%3A%5Bi.%5D%20!%3D%20nil%20%7B%0A%20%20if%20%3A%5B_.%5D%2C%20ok%20%3A%3D%20%3A%5Bi.%5D.(%3A%5BT%5D)%3B%20ok%20%7B%20...%20%7D%0A%7D%0A%0Aor%0A%0A%2F%2F%20Omit%20redundant%20control%20flow%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1023%0Afunc%20%3A%5Bfn.%5D(...)%20%7B...%20return%20%7D%20%20or%20%0Afunc()%20%7B...%20return%20%7D%20or%0A%0A%2F%2F%20Replace%20x.Sub(time.Now())%20with%20time.Until(x)%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1024%0A.Sub(time.Now())%20or%0A%0A%2F%2F%20Don%27t%20use%20fmt.Sprintf(%22%25s%22%2C%20x)%20unnecessarily%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1025%0Afmt.Println(%22%25s%22%2C%20%22...%22)%20or%0A%0A%2F%2F%20Simplify%20error%20construction%20with%20fmt.Errorf%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1028%0Aerrors.New(fmt.Sprintf(...))%20or%0A%0A%2F%2F%20Range%20over%20the%20string%20directly%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1029%0Afor%20%3A%5B~_%5D%2C%20%3A%5B_.%5D%20%3A%3D%20range%20%5B%5Drune(...)%20or%0A%0A%2F%2F%20Use%20sort.Ints(x)%2C%20sort.Float64s(x)%2C%20and%20sort.Strings(x)%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1032%0Asort.Sort(sort.IntSlice(...))%20or%0Asort.Sort(sort.Float64Slice(...))%20or%0Asort.Sort(sort.StringSlice(...))%20or%0A%0A%2F%2F%20Redundant%20call%20to%20net%2Fhttp.CanonicalHeaderKey%20in%20method%20call%20on%20net%2Fhttp.Header%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1035%0Aheaders.Add(http.CanonicalHeaderKey(...)%2C%20...)%20or%0Aheaders.Del(http.CanonicalHeaderKey(...))%20or%0Aheaders.Get(http.CanonicalHeaderKey(...))%20or%0Aheaders.Set(http.CanonicalHeaderKey(...)%2C%20...)%20or%0A%0A%2F%2F%20Unnecessary%20guard%20around%20map%20access%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1036%0Aif%20%3A%5B~_%5D%2C%20ok%20%3A%3D%20%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%3B%20ok%20%7B%0A%20%20%20%20%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%20%2B%3D%20%3A%5Bx.%5D%0A%7D%20else%20%7B%0A%20%20%20%20%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%20%3D%20%3A%5Bx.%5D%0A%7D%0A%0Aor%0A%0Aif%20%3A%5B~_%5D%2C%20ok%20%3A%3D%20%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%3B%20ok%20%7B%0A%20%20%20%20%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%2B%2B%0A%7D%20else%20%7B%0A%20%20%20%20%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%20%3D%201%0A%7D%0A%0Aor%0A%0Aif%20%3A%5B~_%5D%2C%20ok%20%3A%3D%20%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%3B%20ok%20%7B%0A%09%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%20%3D%20append(%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%2C%20%22%3A%5Bv1%5D%22)%0A%7D%20else%20%7B%0A%09%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%20%3D%20%5B%5Dstring%7B%22%3A%5Bv1%5D%22%7D%0A%7D%0A%0Aor%0A%0Aif%20%3A%5B~_%5D%2C%20ok%20%3A%3D%20%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%3B%20ok%20%7B%0A%09%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%20%3D%20append(%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%2C%20%22%3A%5Bv1%5D%22%2C%20%22%3A%5Bv2%5D%22)%0A%7D%20else%20%7B%0A%09%3A%5Bm.%5D%5B%3A%5Bk%5D%5D%20%3D%20%5B%5Dstring%7B%22%3A%5Bv1%5D%22%2C%20%22%3A%5Bv2%5D%22%7D%0A%7D%0A%0Aor%0A%0A%2F%2F%20Elaborate%20way%20of%20sleeping%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1037%0Aselect%20%7B%0A%09case%20%3C-time.After(0)%3A%0A%7D%0A%0Aor%0A%0A%2F%2F%20Unnecessarily%20complex%20way%20of%20printing%20formatted%20string%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1038%0Afmt.Print(fmt.Sprintf(%22...%22%2C%20...))%20or%0Afmt.Println(fmt.Sprintf(%22...%22%2C%20...))%20or%0Afmt.Fprint(nil%2C%20fmt.Sprintf(%22...%22%2C%20...))%20or%0Afmt.Fprintln(nil%2C%20fmt.Sprintf(%22...%22%2C%20...))%20or%0Afmt.Sprint(fmt.Sprintf(%22...%22%2C%20...))%20or%0Afmt.Sprintln(fmt.Sprintf(%22...%22%2C%20...))%20or%20%0A%0A%2F%2F%20Unnecessary%20use%20of%20fmt.Sprint%0A%2F%2F%20https%3A%2F%2Fstaticcheck.io%2Fdocs%2Fchecks%23S1039%0Afmt.Sprintf(%22%25s%22%2C%20%22...%22)\">the complete query</a> into open source\ncontributions, e-mail me at <a href=\"mailto:rijnard@sourcegraph.com\">rijnard@sourcegraph.com</a>, I can help.</p>\n<h2 id=\"Whats-next-for-search-queries\" style=\"position:relative;\"><a href=\"#Whats-next-for-search-queries\" aria-label=\"Whats next for search queries permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 18 95 120\" height=\"18\" width=\"18\"><path d=\"M53.69,78.7H37.94l-5.85,25H21.74l5.85-25H15.89L18,69.1H29.84l4.65-19.65H23.39l2.1-9.6H36.74l5.7-23.7H52.79l-5.7,23.7H62.84l5.7-23.7H78.89l-5.7,23.7H84.74l-2.4,9.6H70.94L66.29,69.1H77.24l-2.4,9.6H64l-5.85,25H47.84Zm-13.5-9.6H55.94l4.65-19.65H44.84Z\"/></svg></a>What’s next for search queries</h2>\n<p>There are many languages and code checkers to explore, and this post only skims\nthe surface. We want to make high-quality code checks available for your\nprojects and languages. If you have a project or query in mind, feel free to\n<a href=\"https://github.com/sourcegraph/sourcegraph/issues/new?assignees=&#x26;labels=&#x26;template=feature_request.md&#x26;title=Code%20check\">open an issue on GitHub</a>\nwith your thoughts. We’re still working on performance and usability enhancements\nso that you can search your code and not just popular projects, so stay tuned!\nIn the meantime, you can find an all-in-one config for replacing the patterns on your local machine\nat <a href=\"https://github.com/comby-tools/go-patterns\">comby-tools/go-patterns</a>. If you want to make large scale,\norg-wide changes, talk to us about <a href=\"https://docs.sourcegraph.com/batch_changes\">Batch Changes</a>.\nAnd if you find code checking valuable and want to learn more about our work at Sourcegraph, reach us at\n<a href=\"mailto:feedback@sourcegraph.com\">feedback@sourcegraph.com</a>. Happy searching!</p>\n<hr>\n<p><sup>1</sup> Another one of my favorites tools using the same principle is <a href=\"https://github.com/jonase/kibit\">Kibit</a> for Clojure.\n<br/>\n<sup>2</sup> See the <a href=\"https://about.sourcegraph.com/blog/code-search-turned-code-checker/\">structural search reference</a> for more details about special syntax.\n<br/>\n<sup>3</sup> These are all the <a href=\"https://staticcheck.io/docs/checks\">simple static check</a> of the form <code class=\"language-text\">S&lt;number&gt;</code>, excluding <code class=\"language-text\">SA</code> and <code class=\"language-text\">ST</code> checks.\n<br/>\n<sup>4</sup> There’s plenty of opportunity to pick other tools or languages, I picked <code class=\"language-text\">staticcheck</code> because its the nicely illustrative.</sup>\n<br/>\n<sup>5</sup> Also, it probably makes sense for these projects to run <code class=\"language-text\">staticcheck</code> in their CI, and a quick search helps make it more obvious which ones do not 😛.</p>\n<hr>\n<sup>\n<p>Acks: Thanks <a href=\"https://twitter.com/lguychard\">@lguychard</a>,\n<a href=\"https://twitter.com/thorstenball\">@thorstenball</a>, <a href=\"https://github.com/stefanhengl\">@stefanhengl</a> <a href=\"https://twitter.com/beyang\">@beyang</a>,\n<a href=\"https://twitter.com/sqs\">@sqs</a> for feedback on the content of this post.\n</sup></p>"}