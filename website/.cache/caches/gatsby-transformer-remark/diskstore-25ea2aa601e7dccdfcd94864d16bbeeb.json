{"expireTime":9007200905229171000,"key":"transformer-remark-markdown-html-732c6983f179b8495a408bb7a7769d24-gatsby-remark-autolink-headersgatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-unwrap-imagesgatsby-remark-imagesgatsby-remark-smartypants-","val":"<p>Developers on some teams frequently search multiple revisions, such as long-lived release branches or important tags. We added <a href=\"/blog/sourcegraph-3.16#introducing-version-contexts-to-search-past-releases\">version contexts</a> in Sourcegraph 3.16 to make it easier for developers to search a collection of repositories at specified revisions. However, Sourcegraph still only <em>indexed</em> your default branch (whichever branch <code class=\"language-text\">HEAD</code> points to in Git, conventionally the branch called <code class=\"language-text\">master</code>). This meant that when searching a non-default branch for the first time, Sourcegraph would not consult an index, leading to long, multi-second waits for search results or in some cases, timeouts.</p>\n<p>In Sourcegraph 3.18, we have added the ability to index branches other than the default branch, which should keep most searches under one second.</p>\n<h2 id=\"Example-configuration\" style=\"position:relative;\"><a href=\"#Example-configuration\" aria-label=\"Example configuration permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 18 95 120\" height=\"18\" width=\"18\"><path d=\"M53.69,78.7H37.94l-5.85,25H21.74l5.85-25H15.89L18,69.1H29.84l4.65-19.65H23.39l2.1-9.6H36.74l5.7-23.7H52.79l-5.7,23.7H62.84l5.7-23.7H78.89l-5.7,23.7H84.74l-2.4,9.6H70.94L66.29,69.1H77.24l-2.4,9.6H64l-5.85,25H47.84Zm-13.5-9.6H55.94l4.65-19.65H44.84Z\"/></svg></a>Example configuration</h2>\n<p>Here’s how you would configure Sourcegraph to index multiple branches:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"experimentalFeatures\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"search.index.branches\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"github.com/sourcegraph/sourcegraph\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"3.17\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"v3.0.0\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"github.com/kubernetes/kubernetes\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"release-1.17\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"github.com/go-yaml/yaml\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"v2\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"v3\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And here’s how you can enable version contexts to search multiple repositories at a coherent set of (non-default) revisions:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"experimentalFeatures\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"versionContexts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Current\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"revisions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span> <span class=\"token property\">\"rev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"HEAD\"</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"repo\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"github.com/sourcegraph/sourcegraph\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span> <span class=\"token property\">\"rev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"HEAD\"</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"repo\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"github.com/sourcegraph/deploy-sourcegraph\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span> <span class=\"token property\">\"rev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"HEAD\"</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"repo\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"github.com/sourcegraph/zoekt\"</span> <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"3.17\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"revisions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span> <span class=\"token property\">\"rev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"v3.17.3\"</span><span class=\"token punctuation\">,</span>  <span class=\"token property\">\"repo\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"github.com/sourcegraph/sourcegraph\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span> <span class=\"token property\">\"rev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"3.17\"</span><span class=\"token punctuation\">,</span>     <span class=\"token property\">\"repo\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"github.com/sourcegraph/sourcegraph\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span> <span class=\"token property\">\"rev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"3.17\"</span><span class=\"token punctuation\">,</span>     <span class=\"token property\">\"repo\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"github.com/sourcegraph/deploy-sourcegraph\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span> <span class=\"token property\">\"rev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"8aa57bd3\"</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"repo\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"github.com/sourcegraph/zoekt\"</span> <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Any <code class=\"language-text\">repo@revision</code> mentioned in a version context or in <code class=\"language-text\">search.index.branches</code> will be indexed by the periodic indexing process (you may need to wait a few minutes for indexing to occur). As an admin you can view what is indexed for a repository through the repository setting page (“Indexing” section).</p>\n<p>The same periodic process that cleans up old indexes and deleted repositories will also clean up deleted branches, so this gets cleaned up automatically.</p>\n<p>This scales with the number of <em>unique</em> documents at a path. For example, if you index a branch A which only has one file different from your default branch, the index will only grow in size by one document. So in practice, most indexes won’t grow much by adding a branch. There is a limit of 64 indexed branches per repository.</p>\n<p>GitHub issue: <a href=\"https://github.com/sourcegraph/sourcegraph/issues/6728\">#6728</a></p>"}